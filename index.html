<!DOCTYPE html>
<html>
<head>
<title>Civ5 Damage Calculator</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
* {
  box-sizing: border-box;
}

body {
  font-family: Arial, Helvetica, sans-serif;
}

/* Style the header */
header {
  background-color: #666;
  padding: 30px;
  text-align: center;
  font-size: 25px;
  color: white;
}

/* Create two columns/boxes that floats next to each other */
aside {
  float: left;
  width: 30%;
  background: #ccc;
  padding: 20px;
}


article {
  float: left;
  padding: 20px;
  width: 70%;
  background-color: #f1f1f1;
}

/* Clear floats after the columns */
section:after {
  content: "";
  display: table;
  clear: both;
}

/* Style the footer */
footer {
  background-color: #777;
  padding: 10px;
  text-align: center;
  color: white;
}
label {
    background:#ccc;
    color:black;
    border-radius:4px;   
    padding:0.3em;
    cursor:pointer;
	}
label:hover {
    background:#aaa;   
	}
input {
    margin-right:1em;   
	}
/* Responsive layout - makes the two columns/boxes stack on top of each other instead of next to each other, on small screens */
@media (max-width: 700px) {
  aside, article {
    width: 100%;
    height: auto;
	}
  
}
</style>
</head>

<body>
<header>
  <h2>Civ5 Damage Calculator</h2>
</header>

<section>
<aside>
	<p>select mode:</p>
	<p>
    <select name="selectedmode">
 		<option value="singlemode">single unit</option>
 		<option value="tablemode">WIP table</option>
	</select> 
	</p>
	<p><label><input type="radio" name="CombatType" value="Melee" checked> Melee Attack</label></p>
	<p><label><input type="radio" name="CombatType" value="Ranged"> WIP Ranged Attack</label></p>
	<p><label><input type="radio" name="CombatType" value="Air" > WIP Air Attack</label></p>
    <p><label><input type="checkbox" id="IncludeRand" name="IncludeRand" value="IncludeRand"> Include random</label></p>
	<p><label><input type="checkbox" id="AttackerIsCity" name="AttackerIsCity" value="AttackerIsCity"> Attacker is city</label></p>
	<p><label><input type="checkbox" id="DefenderIsCity" name="DefenderIsCity" value="DefenderIsCity"> Defender is city</label></p>
	<p><label><input type="checkbox" id="JAPAN_TRAIT" name="JAPAN_TRAIT" value="JAPAN_TRAIT"> Attacker is Japan</label></p>
	<p><label><input type="checkbox" id="ELITE_FORCES_POLICY" name="ELITE_FORCES_POLICY" value="ELITE_FORCES_POLICY"> Attacker has "Elite Forces" policy</label></p>
</aside>
  
<article>
    <h1>Enter the following values.</h1>
    <p>your strength:<br>
	<input id="Strength" name="Strength" type="text" value="8"> <br>
enemy's strength:<br>
	<input id="OpponentStrength" name="OpponentStrength" type="text" value="5"> <br>
your HP:<br>
	<input id="CurrentHP" name="CurrentHP" type="text" value="100"> <br><br>
    <button type="button" onclick="getCombatDamage(Strength.value, OpponentStrength.value, CurrentHP.value)">Proceed!</button> </p>
</article>
</section>

<footer>
  <p>Damage: <input type="text" id="DamageOutput" name="Damage"></p>
</footer>


<script>
function getCombatDamage(iStrength, iOpponentStrength, iCurrentHP) {
	var iDamageRatio;
	var iWoundedDamageMultiplier = 33;
	var iCurrentDamage = 100 - iCurrentHP;
    var bIncludeRand = (document.getElementById('IncludeRand').checked), bAttackerIsCity = (document.getElementById('AttackerIsCity').checked), bDefenderIsCity = (document.getElementById('DefenderIsCity').checked), bJAPAN_TRAIT = (document.getElementById('JAPAN_TRAIT').checked), bELITE_FORCES_POLICY = (document.getElementById('ELITE_FORCES_POLICY').checked);
    iStrength = Math.floor(iStrength*100);
    iOpponentStrength = Math.floor(iOpponentStrength*100);
    iCurrentHP = Math.floor(iCurrentHP);
    //////////////////////////////////////////
	if(bAttackerIsCity) {
			iDamageRatio = 100;	// JON: Cities don't do less damage when wounded
		}
		else
		{
			// Mod (Policies, etc.)
			if (bJAPAN_TRAIT) iWoundedDamageMultiplier += -33
        	else if (bELITE_FORCES_POLICY) 	iWoundedDamageMultiplier += -25;
			iDamageRatio = 100 - Math.floor(iCurrentDamage * iWoundedDamageMultiplier / 100);
		}
    var iDamage = 0;
	iDamage = 24 * iDamageRatio;
	// Don't use rand when calculating projected combat results
	var iRoll = 0;
	if(bIncludeRand)
	{
		iRoll = Math.floor((Math.random() * 1200));
		iRoll *= iDamageRatio;
		iRoll = Math.floor(iRoll / 100);
	} 
    else
	{
		iRoll = 1200;
		iRoll -= 1;	// Subtract 1 here, because this is the amount normally "lost" when doing a rand roll
		iRoll *= iDamageRatio;
		iRoll = Math.floor(iRoll / 100);
		iRoll = Math.floor(iRoll / 2);	// The divide by 2 is to provide the average damage
	}
	iDamage += iRoll; 
    var fStrengthRatio = iStrength / iOpponentStrength;

	// In case our strength is less than the other guy's, we'll do things in reverse then make the ratio 1 over the result (we need a # above 1.0)
	if(iOpponentStrength > iStrength)
	{
		fStrengthRatio = iOpponentStrength / iStrength;
	}
    
	fStrengthRatio = (fStrengthRatio + 3) / 4;
	fStrengthRatio = Math.pow(fStrengthRatio, 4.0);
	fStrengthRatio = (fStrengthRatio + 1) / 2;

	if(iOpponentStrength > iStrength)
	{
		fStrengthRatio = 1 / fStrengthRatio;
	}

	iDamage = Math.floor(iDamage * fStrengthRatio);
// Modify damage for when a city "attacks" a unit
	/*
    if(bAttackerIsCity)
	{
		iDamage *= 100;
		iDamage /= 100;
	}

	// Modify damage for when unit is attacking a city
	if(bDefenderIsCity)
	{
		iDamage *= 100;
		iDamage /= 100;
	}
	*/
	// Bring it back out of hundreds
	iDamage = Math.floor(iDamage / 100);
    
	if (iDamage < 1) iDamage = 1;
    document.getElementById('DamageOutput').value = iDamage;
	return iDamage;
	}
</script>

</body>
</html>
